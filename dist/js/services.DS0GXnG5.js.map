{"version":3,"file":"services.DS0GXnG5.js","sources":["../../src/services/StorageService.ts","../../src/services/MigrationService.ts","../../src/services/StockApiService.ts"],"sourcesContent":["/**\r\n * StorageService for v1.3.X architecture\r\n * Handles all LocalStorage operations for portfolio data\r\n * \r\n * Key features:\r\n * - Version-isolated storage using 'stockPortfolio_v1.3' key\r\n * - Error handling for quota exceeded scenarios\r\n * - JSON serialization/deserialization\r\n * - Data validation\r\n */\r\n\r\nimport { PortfolioData } from '../types/Portfolio';\r\nimport { StorageError } from '../types/Errors';\r\n\r\n/**\r\n * Service class for managing portfolio data storage\r\n * Encapsulates all LocalStorage operations\r\n */\r\nexport class StorageService {\r\n  /** Storage key for v1.3.X data - isolated from v1.2.X */\r\n  private readonly STORAGE_KEY = 'stockPortfolio_v1.3';\r\n  \r\n  /**\r\n   * Save portfolio data to LocalStorage\r\n   * @param data - Complete portfolio data to save\r\n   * @throws {StorageError} If storage quota is exceeded or serialization fails\r\n   */\r\n  save(data: PortfolioData): void {\r\n    try {\r\n      // Update last modified timestamp\r\n      data.metadata.lastModified = new Date().toISOString();\r\n      \r\n      // Serialize data to JSON\r\n      const json = JSON.stringify(data);\r\n      \r\n      // Save to LocalStorage\r\n      localStorage.setItem(this.STORAGE_KEY, json);\r\n    } catch (error: any) {\r\n      // Handle quota exceeded error\r\n      if (error.name === 'QuotaExceededError') {\r\n        throw new StorageError('儲存空間不足，請清理瀏覽器資料或匯出備份');\r\n      }\r\n      \r\n      // Handle other errors\r\n      throw new StorageError(`儲存資料失敗: ${error.message}`);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Load portfolio data from LocalStorage\r\n   * @returns Portfolio data if exists, null otherwise\r\n   * @throws {StorageError} If data parsing fails\r\n   */\r\n  load(): PortfolioData | null {\r\n    try {\r\n      // Retrieve data from LocalStorage\r\n      const json = localStorage.getItem(this.STORAGE_KEY);\r\n      \r\n      // Return null if no data exists\r\n      if (!json) {\r\n        return null;\r\n      }\r\n      \r\n      // Parse and return data\r\n      const data = JSON.parse(json) as PortfolioData;\r\n      return data;\r\n    } catch (error: any) {\r\n      // Log parsing error but don't throw - allow recovery\r\n      console.error('資料解析失敗:', error);\r\n      throw new StorageError(`載入資料失敗: ${error.message}`);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Clear all portfolio data from LocalStorage\r\n   * Removes the v1.3 storage key completely\r\n   */\r\n  clear(): void {\r\n    localStorage.removeItem(this.STORAGE_KEY);\r\n  }\r\n  \r\n  /**\r\n   * Check if portfolio data exists in LocalStorage\r\n   * @returns true if data exists, false otherwise\r\n   */\r\n  hasData(): boolean {\r\n    return localStorage.getItem(this.STORAGE_KEY) !== null;\r\n  }\r\n  \r\n  /**\r\n   * Get the storage key used by this service\r\n   * Useful for debugging and testing\r\n   * @returns The storage key string\r\n   */\r\n  getStorageKey(): string {\r\n    return this.STORAGE_KEY;\r\n  }\r\n}\r\n","/**\r\n * MigrationService for v1.3.X architecture\r\n * Handles data migration from v1.2.X to v1.3.X\r\n * \r\n * Key features:\r\n * - Detects old version data (v1.2.X)\r\n * - Transforms data structure to new format\r\n * - Validates migration results\r\n * - Preserves old data (no deletion)\r\n * - Provides rollback capability on failure\r\n */\r\n\r\nimport { PortfolioData } from '../types/Portfolio';\r\nimport { Stock } from '../types/Stock';\r\nimport { Account } from '../types/Account';\r\nimport { Dividend } from '../types/Dividend';\r\nimport { StorageError } from '../types/Errors';\r\n\r\n/**\r\n * Result of migration operation\r\n */\r\nexport interface MigrationResult {\r\n  /** Whether migration was successful */\r\n  success: boolean;\r\n  \r\n  /** Number of stocks migrated (if successful) */\r\n  migratedStocks?: number;\r\n  \r\n  /** Number of accounts migrated (if successful) */\r\n  migratedAccounts?: number;\r\n  \r\n  /** Error message (if failed) */\r\n  error?: string;\r\n}\r\n\r\n/**\r\n * Old v1.2.X data structure\r\n */\r\ninterface V12Data {\r\n  stocks: V12Stock[];\r\n  accounts: string[];\r\n  lastTotalValue?: number;\r\n  lastSync?: string;\r\n}\r\n\r\n/**\r\n * Old v1.2.X stock structure\r\n */\r\ninterface V12Stock {\r\n  stockCode: string;\r\n  stockName: string;\r\n  quantity: number;\r\n  buyPrice: number;\r\n  currentPrice: number;\r\n  buyDate: string;\r\n  account: string;\r\n  dividends?: V12Dividend[];\r\n  [key: string]: any; // Allow other fields\r\n}\r\n\r\n/**\r\n * Old v1.2.X dividend structure\r\n */\r\ninterface V12Dividend {\r\n  date: string;\r\n  amount: number;\r\n  shares?: number;\r\n  [key: string]: any;\r\n}\r\n\r\n/**\r\n * Service class for migrating data from v1.2.X to v1.3.X\r\n */\r\nexport class MigrationService {\r\n  /** Storage key for v1.2.X data */\r\n  private readonly OLD_STORAGE_KEY = 'stockPortfolio_v1.2';\r\n  \r\n  /** Storage key for v1.3.X data */\r\n  private readonly NEW_STORAGE_KEY = 'stockPortfolio_v1.3';\r\n  \r\n  /**\r\n   * Check if old version data exists\r\n   * @returns true if v1.2.X data exists in LocalStorage\r\n   */\r\n  hasOldData(): boolean {\r\n    return localStorage.getItem(this.OLD_STORAGE_KEY) !== null;\r\n  }\r\n  \r\n  /**\r\n   * Check if new version data exists\r\n   * @returns true if v1.3.X data exists in LocalStorage\r\n   */\r\n  hasNewData(): boolean {\r\n    return localStorage.getItem(this.NEW_STORAGE_KEY) !== null;\r\n  }\r\n  \r\n  /**\r\n   * Determine if migration prompt should be shown\r\n   * @returns true if old data exists but new data doesn't\r\n   */\r\n  shouldPromptMigration(): boolean {\r\n    return this.hasOldData() && !this.hasNewData();\r\n  }\r\n  \r\n  /**\r\n   * Execute data migration from v1.2.X to v1.3.X\r\n   * @returns Migration result with success status and details\r\n   */\r\n  migrate(): MigrationResult {\r\n    try {\r\n      // 1. 讀取舊版資料\r\n      const oldData = this.loadOldData();\r\n      if (!oldData) {\r\n        throw new StorageError('無法讀取舊版資料');\r\n      }\r\n      \r\n      // 2. 轉換資料格式\r\n      const newData = this.transformData(oldData);\r\n      \r\n      // 3. 驗證轉換結果\r\n      this.validateNewData(newData);\r\n      \r\n      // 4. 儲存到新版 (不使用 StorageService 以避免循環依賴)\r\n      localStorage.setItem(this.NEW_STORAGE_KEY, JSON.stringify(newData));\r\n      \r\n      // 5. 保留舊版資料（不刪除）- 這是設計要求\r\n      \r\n      console.log('✅ 資料遷移成功', {\r\n        stocks: newData.stocks.length,\r\n        accounts: newData.accounts.length,\r\n        from: this.OLD_STORAGE_KEY,\r\n        to: this.NEW_STORAGE_KEY\r\n      });\r\n      \r\n      return {\r\n        success: true,\r\n        migratedStocks: newData.stocks.length,\r\n        migratedAccounts: newData.accounts.length\r\n      };\r\n    } catch (error: any) {\r\n      console.error('❌ 資料遷移失敗:', error);\r\n      \r\n      // 回滾：如果新版資料已寫入但驗證失敗，則刪除\r\n      try {\r\n        localStorage.removeItem(this.NEW_STORAGE_KEY);\r\n      } catch (rollbackError) {\r\n        console.error('回滾失敗:', rollbackError);\r\n      }\r\n      \r\n      return {\r\n        success: false,\r\n        error: error.message || '未知錯誤'\r\n      };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Load old version data from LocalStorage\r\n   * @returns Old data structure or null if not found\r\n   * @private\r\n   */\r\n  private loadOldData(): V12Data | null {\r\n    try {\r\n      const json = localStorage.getItem(this.OLD_STORAGE_KEY);\r\n      if (!json) {\r\n        return null;\r\n      }\r\n      \r\n      const data = JSON.parse(json) as V12Data;\r\n      return data;\r\n    } catch (error: any) {\r\n      throw new StorageError(`解析舊版資料失敗: ${error.message}`);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Transform v1.2.X data structure to v1.3.X format\r\n   * @param oldData - Old version data\r\n   * @returns New version data structure\r\n   * @private\r\n   */\r\n  private transformData(oldData: V12Data): PortfolioData {\r\n    const migrationTime = new Date().toISOString();\r\n    \r\n    // 建立帳戶 ID 對照表\r\n    const accountMap = new Map<string, string>();\r\n    const accounts: Account[] = [];\r\n    \r\n    // 轉換帳戶\r\n    if (oldData.accounts && oldData.accounts.length > 0) {\r\n      oldData.accounts.forEach((accountName) => {\r\n        const accountId = this.generateUUID();\r\n        accountMap.set(accountName, accountId);\r\n        \r\n        accounts.push({\r\n          id: accountId,\r\n          name: accountName,\r\n          createdAt: migrationTime\r\n        });\r\n      });\r\n    } else {\r\n      // 如果沒有帳戶，建立預設帳戶\r\n      const defaultAccountId = this.generateUUID();\r\n      accountMap.set('預設帳戶', defaultAccountId);\r\n      accounts.push({\r\n        id: defaultAccountId,\r\n        name: '預設帳戶',\r\n        createdAt: migrationTime\r\n      });\r\n    }\r\n    \r\n    // 轉換股票\r\n    const stocks: Stock[] = [];\r\n    const dividends: Dividend[] = [];\r\n    \r\n    if (oldData.stocks && oldData.stocks.length > 0) {\r\n      oldData.stocks.forEach((oldStock) => {\r\n        // 取得對應的帳戶 ID\r\n        const accountId = accountMap.get(oldStock.account) || accounts[0].id;\r\n        \r\n        // 建立新股票記錄\r\n        const stockId = this.generateUUID();\r\n        const newStock: Stock = {\r\n          id: stockId,\r\n          code: oldStock.stockCode,\r\n          name: oldStock.stockName,\r\n          shares: oldStock.quantity,\r\n          costPrice: oldStock.buyPrice,\r\n          currentPrice: oldStock.currentPrice || oldStock.buyPrice,\r\n          purchaseDate: this.convertDateToISO(oldStock.buyDate),\r\n          accountId: accountId,\r\n          lastUpdated: migrationTime,\r\n          dataSource: 'Local'\r\n        };\r\n        \r\n        stocks.push(newStock);\r\n        \r\n        // 轉換股息記錄（如果有）\r\n        if (oldStock.dividends && Array.isArray(oldStock.dividends)) {\r\n          oldStock.dividends.forEach((oldDividend) => {\r\n            const dividend: Dividend = {\r\n              id: this.generateUUID(),\r\n              stockId: stockId,\r\n              exDividendDate: this.convertDateToISO(oldDividend.date),\r\n              dividendPerShare: oldDividend.amount,\r\n              totalDividend: oldDividend.amount * (oldDividend.shares || oldStock.quantity),\r\n              createdAt: migrationTime\r\n            };\r\n            \r\n            dividends.push(dividend);\r\n          });\r\n        }\r\n      });\r\n    }\r\n    \r\n    // 建立新版資料結構\r\n    const newData: PortfolioData = {\r\n      version: '1.3.0',\r\n      accounts: accounts,\r\n      stocks: stocks,\r\n      dividends: dividends,\r\n      settings: {\r\n        privacyMode: false,\r\n        darkMode: false,\r\n        autoUpdate: true,\r\n        updateInterval: 300000, // 5 分鐘\r\n        cloudSync: {\r\n          enabled: false\r\n        }\r\n      },\r\n      metadata: {\r\n        createdAt: migrationTime,\r\n        lastModified: migrationTime,\r\n        migratedFrom: 'v1.2.X'\r\n      }\r\n    };\r\n    \r\n    return newData;\r\n  }\r\n  \r\n  /**\r\n   * Validate migrated data structure\r\n   * @param data - New version data to validate\r\n   * @throws {StorageError} If validation fails\r\n   * @private\r\n   */\r\n  private validateNewData(data: PortfolioData): void {\r\n    // 驗證必要欄位\r\n    if (!data.version) {\r\n      throw new StorageError('遷移資料缺少版本號');\r\n    }\r\n    \r\n    if (!Array.isArray(data.accounts)) {\r\n      throw new StorageError('遷移資料的帳戶格式不正確');\r\n    }\r\n    \r\n    if (!Array.isArray(data.stocks)) {\r\n      throw new StorageError('遷移資料的股票格式不正確');\r\n    }\r\n    \r\n    if (!Array.isArray(data.dividends)) {\r\n      throw new StorageError('遷移資料的股息格式不正確');\r\n    }\r\n    \r\n    // 驗證每支股票\r\n    data.stocks.forEach((stock, index) => {\r\n      if (!stock.id || !stock.code || !stock.name) {\r\n        throw new StorageError(`股票 ${index + 1} 缺少必要欄位`);\r\n      }\r\n      \r\n      if (typeof stock.shares !== 'number' || stock.shares <= 0) {\r\n        throw new StorageError(`股票 ${stock.code} 的持股數無效`);\r\n      }\r\n      \r\n      if (typeof stock.costPrice !== 'number' || stock.costPrice <= 0) {\r\n        throw new StorageError(`股票 ${stock.code} 的成本價無效`);\r\n      }\r\n      \r\n      // 驗證帳戶 ID 存在\r\n      const accountExists = data.accounts.some(acc => acc.id === stock.accountId);\r\n      if (!accountExists) {\r\n        throw new StorageError(`股票 ${stock.code} 的帳戶 ID 不存在`);\r\n      }\r\n    });\r\n    \r\n    // 驗證每個帳戶\r\n    data.accounts.forEach((account, index) => {\r\n      if (!account.id || !account.name) {\r\n        throw new StorageError(`帳戶 ${index + 1} 缺少必要欄位`);\r\n      }\r\n    });\r\n    \r\n    // 驗證每筆股息\r\n    data.dividends.forEach((dividend, index) => {\r\n      if (!dividend.id || !dividend.stockId) {\r\n        throw new StorageError(`股息記錄 ${index + 1} 缺少必要欄位`);\r\n      }\r\n      \r\n      // 驗證股票 ID 存在\r\n      const stockExists = data.stocks.some(stock => stock.id === dividend.stockId);\r\n      if (!stockExists) {\r\n        throw new StorageError(`股息記錄 ${index + 1} 的股票 ID 不存在`);\r\n      }\r\n    });\r\n    \r\n    console.log('✅ 資料驗證通過');\r\n  }\r\n  \r\n  /**\r\n   * Generate a UUID v4\r\n   * @returns UUID string\r\n   * @private\r\n   */\r\n  private generateUUID(): string {\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\r\n      const r = Math.random() * 16 | 0;\r\n      const v = c === 'x' ? r : (r & 0x3 | 0x8);\r\n      return v.toString(16);\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Convert date string to ISO 8601 format\r\n   * @param dateStr - Date string in various formats\r\n   * @returns ISO 8601 formatted date string\r\n   * @private\r\n   */\r\n  private convertDateToISO(dateStr: string): string {\r\n    if (!dateStr) {\r\n      return new Date().toISOString();\r\n    }\r\n    \r\n    try {\r\n      // 嘗試解析日期\r\n      const date = new Date(dateStr);\r\n      \r\n      // 檢查是否為有效日期\r\n      if (isNaN(date.getTime())) {\r\n        console.warn(`無效的日期格式: ${dateStr}，使用當前時間`);\r\n        return new Date().toISOString();\r\n      }\r\n      \r\n      return date.toISOString();\r\n    } catch (error) {\r\n      console.warn(`日期轉換失敗: ${dateStr}，使用當前時間`);\r\n      return new Date().toISOString();\r\n    }\r\n  }\r\n}\r\n","/**\r\n * StockApiService - 股價 API 服務\r\n * \r\n * 負責從多個來源取得股票價格和資訊：\r\n * 1. 證交所 API (TWSE/TPEx) - 最高優先級\r\n * 2. Yahoo Finance API - 次優先級\r\n * 3. 本地資料庫 - 最低優先級\r\n * \r\n * 包含快取機制以減少 API 呼叫次數\r\n */\r\n\r\nimport type {\r\n  StockPriceResult,\r\n  StockInfo,\r\n  CachedPrice,\r\n  TWSEApiResponse,\r\n  YahooFinanceResponse,\r\n  LocalStockEntry\r\n} from '../types/Api';\r\nimport { ApiError } from '../types/Errors';\r\n\r\n/**\r\n * 股價 API 服務類別\r\n */\r\nexport class StockApiService {\r\n  /** 快取儲存 - 使用 Map 結構存儲股票代碼對應的價格資料 */\r\n  private cache: Map<string, CachedPrice> = new Map();\r\n  \r\n  /** 快取有效期限 (TTL) - 預設 1 分鐘 (60000 毫秒) */\r\n  private readonly CACHE_TTL = 60000;\r\n  \r\n  /** 本地股票資料庫 - 股票代碼對照表 */\r\n  private localDB: Map<string, LocalStockEntry> = new Map();\r\n  \r\n  /** API 請求逾時時間 (毫秒) */\r\n  private readonly API_TIMEOUT = 10000;\r\n  \r\n  constructor() {\r\n    // 初始化時載入本地資料庫\r\n    this.loadLocalDatabase();\r\n  }\r\n  \r\n  /**\r\n   * 檢查快取是否有效\r\n   * @param code - 股票代碼\r\n   * @returns 快取是否有效\r\n   */\r\n  private isCacheValid(code: string): boolean {\r\n    const cached = this.cache.get(code);\r\n    \r\n    if (!cached) {\r\n      return false;\r\n    }\r\n    \r\n    const now = Date.now();\r\n    const age = now - cached.cachedAt;\r\n    \r\n    // 檢查快取是否在有效期限內\r\n    return age < this.CACHE_TTL;\r\n  }\r\n  \r\n  /**\r\n   * 更新快取\r\n   * @param code - 股票代碼\r\n   * @param result - 股價查詢結果\r\n   */\r\n  private updateCache(code: string, result: StockPriceResult): void {\r\n    const cached: CachedPrice = {\r\n      data: result,\r\n      cachedAt: Date.now()\r\n    };\r\n    \r\n    this.cache.set(code, cached);\r\n  }\r\n  \r\n  /**\r\n   * 清除特定股票的快取\r\n   * @param code - 股票代碼\r\n   */\r\n  public clearCache(code: string): void {\r\n    this.cache.delete(code);\r\n  }\r\n  \r\n  /**\r\n   * 清除所有快取\r\n   */\r\n  public clearAllCache(): void {\r\n    this.cache.clear();\r\n  }\r\n  \r\n  /**\r\n   * 載入本地股票資料庫\r\n   * 從內建的股票名稱對照表載入資料\r\n   */\r\n  private loadLocalDatabase(): void {\r\n    // 常見台股股票名稱對照表\r\n    const stockData: LocalStockEntry[] = [\r\n      // 權值股\r\n      { code: '2330', name: '台積電', type: '上市' },\r\n      { code: '2317', name: '鴻海', type: '上市' },\r\n      { code: '2454', name: '聯發科', type: '上市' },\r\n      { code: '2308', name: '台達電', type: '上市' },\r\n      { code: '2303', name: '聯電', type: '上市' },\r\n      { code: '2412', name: '中華電', type: '上市' },\r\n      { code: '3008', name: '大立光', type: '上市' },\r\n      { code: '2002', name: '中鋼', type: '上市' },\r\n      { code: '1301', name: '台塑', type: '上市' },\r\n      { code: '1303', name: '南亞', type: '上市' },\r\n      { code: '1326', name: '台化', type: '上市' },\r\n      { code: '2882', name: '國泰金', type: '上市' },\r\n      { code: '2881', name: '富邦金', type: '上市' },\r\n      { code: '2886', name: '兆豐金', type: '上市' },\r\n      { code: '2891', name: '中信金', type: '上市' },\r\n      { code: '2892', name: '第一金', type: '上市' },\r\n      { code: '2884', name: '玉山金', type: '上市' },\r\n      { code: '2885', name: '元大金', type: '上市' },\r\n      { code: '2887', name: '台新金', type: '上市' },\r\n      { code: '2890', name: '永豐金', type: '上市' },\r\n      { code: '2883', name: '開發金', type: '上市' },\r\n      { code: '1216', name: '統一', type: '上市' },\r\n      { code: '1101', name: '台泥', type: '上市' },\r\n      { code: '2207', name: '和泰車', type: '上市' },\r\n      { code: '2382', name: '廣達', type: '上市' },\r\n      { code: '2357', name: '華碩', type: '上市' },\r\n      { code: '2301', name: '光寶科', type: '上市' },\r\n      { code: '2409', name: '友達', type: '上市' },\r\n      { code: '3045', name: '台灣大', type: '上市' },\r\n      { code: '4904', name: '遠傳', type: '上市' },\r\n      \r\n      // 熱門 ETF\r\n      { code: '0050', name: '元大台灣50', type: 'ETF' },\r\n      { code: '0056', name: '元大高股息', type: 'ETF' },\r\n      { code: '00878', name: '國泰永續高股息', type: 'ETF' },\r\n      { code: '00881', name: '國泰台灣5G+', type: 'ETF' },\r\n      { code: '00900', name: '富邦特選高股息30', type: 'ETF' },\r\n      { code: '00919', name: '群益台灣精選高息', type: 'ETF' },\r\n      { code: '00929', name: '復華台灣科技優息', type: 'ETF' },\r\n      { code: '00631L', name: '元大台灣50正2', type: 'ETF' },\r\n      { code: '00632R', name: '元大台灣50反1', type: 'ETF' },\r\n      { code: '00757', name: '統一FANG+', type: 'ETF' },\r\n      { code: '00830', name: '國泰費城半導體', type: 'ETF' },\r\n      { code: '00850', name: '元大臺灣ESG永續', type: 'ETF' },\r\n      { code: '00692', name: '富邦公司治理', type: 'ETF' },\r\n      { code: '00701', name: '國泰股利精選30', type: 'ETF' },\r\n      { code: '00713', name: '元大台灣高息低波', type: 'ETF' },\r\n      \r\n      // 上櫃股票\r\n      { code: '5274', name: '信驊', type: '上櫃' },\r\n      { code: '6446', name: '藥華藥', type: '上櫃' },\r\n      { code: '4968', name: '立積', type: '上櫃' },\r\n      { code: '6488', name: '環球晶', type: '上櫃' },\r\n      { code: '5269', name: '祥碩', type: '上櫃' },\r\n      { code: '3443', name: '創意', type: '上櫃' },\r\n      { code: '6415', name: '矽力-KY', type: '上櫃' },\r\n      { code: '4919', name: '新唐', type: '上櫃' },\r\n      { code: '6669', name: '緯穎', type: '上櫃' },\r\n      { code: '3711', name: '日月光投控', type: '上櫃' }\r\n    ];\r\n    \r\n    // 載入到 Map 中以便快速查詢\r\n    for (const stock of stockData) {\r\n      this.localDB.set(stock.code, stock);\r\n    }\r\n    \r\n    console.log(`本地資料庫已載入 ${this.localDB.size} 筆股票資料`);\r\n  }\r\n  \r\n  /**\r\n   * 從本地資料庫查詢股價\r\n   * 注意：本地資料庫僅提供股票名稱，不提供即時價格\r\n   * @param code - 股票代碼\r\n   * @returns 股票價格（本地資料庫不提供價格，返回 null）\r\n   */\r\n  private getFromLocalDB(code: string): number | null {\r\n    const stock = this.localDB.get(code);\r\n    \r\n    if (stock) {\r\n      console.log(`本地資料庫找到股票: ${code} - ${stock.name}`);\r\n      // 本地資料庫僅用於提供股票名稱，不提供即時價格\r\n      // 返回 null 表示需要從 API 取得價格\r\n      return null;\r\n    }\r\n    \r\n    console.log(`本地資料庫找不到股票: ${code}`);\r\n    return null;\r\n  }\r\n  \r\n  /**\r\n   * 從本地資料庫取得股票資訊\r\n   * @param code - 股票代碼\r\n   * @returns 股票資訊，如果找不到則返回 null\r\n   */\r\n  private getStockInfoFromLocalDB(code: string): StockInfo | null {\r\n    const stock = this.localDB.get(code);\r\n    \r\n    if (stock) {\r\n      return {\r\n        code: stock.code,\r\n        name: stock.name,\r\n        type: stock.type,\r\n        source: 'Local'\r\n      };\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  /**\r\n   * 取得股票價格\r\n   * 按照優先順序嘗試所有 API：證交所 → Yahoo → 本地資料庫\r\n   * \r\n   * 重要：此方法嚴格遵循搜尋順序，不可更改\r\n   * 1. 證交所 API (TWSE/TPEx) - 最高優先級\r\n   * 2. Yahoo Finance API - 次優先級\r\n   * 3. 本地資料庫 - 最低優先級（僅提供名稱，不提供價格）\r\n   * 4. 拋出錯誤 - 所有方法都失敗\r\n   * \r\n   * @param code - 股票代碼\r\n   * @returns 股價查詢結果\r\n   * @throws {ApiError} 當所有 API 都失敗時\r\n   */\r\n  public async getStockPrice(code: string): Promise<StockPriceResult> {\r\n    // 檢查快取\r\n    if (this.isCacheValid(code)) {\r\n      console.log(`使用快取資料: ${code}`);\r\n      return this.cache.get(code)!.data;\r\n    }\r\n    \r\n    // 1. 嘗試證交所 API (最高優先級)\r\n    try {\r\n      console.log(`[1/3] 嘗試證交所 API: ${code}`);\r\n      const price = await this.fetchFromTWSE(code);\r\n      const result: StockPriceResult = {\r\n        price,\r\n        source: 'TWSE',\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      this.updateCache(code, result);\r\n      console.log(`✅ 證交所 API 成功: ${code} = ${price}`);\r\n      return result;\r\n    } catch (error) {\r\n      console.warn(`❌ 證交所 API 失敗: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n    \r\n    // 2. 嘗試 Yahoo Finance API (次優先級)\r\n    try {\r\n      console.log(`[2/3] 嘗試 Yahoo Finance API: ${code}`);\r\n      const price = await this.fetchFromYahoo(code);\r\n      const result: StockPriceResult = {\r\n        price,\r\n        source: 'Yahoo',\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      this.updateCache(code, result);\r\n      console.log(`✅ Yahoo Finance API 成功: ${code} = ${price}`);\r\n      return result;\r\n    } catch (error) {\r\n      console.warn(`❌ Yahoo Finance API 失敗: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n    \r\n    // 3. 嘗試本地資料庫 (最低優先級)\r\n    console.log(`[3/3] 嘗試本地資料庫: ${code}`);\r\n    const localPrice = this.getFromLocalDB(code);\r\n    if (localPrice !== null) {\r\n      const result: StockPriceResult = {\r\n        price: localPrice,\r\n        source: 'Local',\r\n        timestamp: new Date().toISOString()\r\n      };\r\n      console.log(`✅ 本地資料庫成功: ${code} = ${localPrice}`);\r\n      return result;\r\n    }\r\n    \r\n    // 4. 所有方法都失敗，拋出錯誤\r\n    console.error(`❌ 所有 API 都無法取得股票 ${code} 的價格`);\r\n    throw new ApiError(`無法取得股票 ${code} 的價格，所有資料來源都失敗`);\r\n  }\r\n  \r\n  /**\r\n   * 搜尋股票資訊\r\n   * 按照優先順序嘗試所有 API：證交所 → Yahoo → 本地資料庫\r\n   * \r\n   * 重要：此方法嚴格遵循搜尋順序，不可更改\r\n   * 1. 證交所 API (TWSE/TPEx) - 最高優先級\r\n   * 2. Yahoo Finance API - 次優先級\r\n   * 3. 本地資料庫 - 最低優先級\r\n   * 4. 拋出錯誤 - 所有方法都失敗\r\n   * \r\n   * @param code - 股票代碼\r\n   * @returns 股票資訊\r\n   * @throws {ApiError} 當所有 API 都失敗時\r\n   */\r\n  public async searchStockByCode(code: string): Promise<StockInfo> {\r\n    // 1. 嘗試證交所 API (最高優先級)\r\n    try {\r\n      console.log(`[1/3] 嘗試證交所 API 搜尋: ${code}`);\r\n      const price = await this.fetchFromTWSE(code);\r\n      \r\n      // 從本地資料庫取得股票名稱（如果有）\r\n      const localInfo = this.getStockInfoFromLocalDB(code);\r\n      \r\n      const result: StockInfo = {\r\n        code,\r\n        name: localInfo?.name || code,\r\n        price,\r\n        type: localInfo?.type,\r\n        source: 'TWSE'\r\n      };\r\n      console.log(`✅ 證交所 API 搜尋成功: ${code}`);\r\n      return result;\r\n    } catch (error) {\r\n      console.warn(`❌ 證交所 API 搜尋失敗: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n    \r\n    // 2. 嘗試 Yahoo Finance API (次優先級)\r\n    try {\r\n      console.log(`[2/3] 嘗試 Yahoo Finance API 搜尋: ${code}`);\r\n      const price = await this.fetchFromYahoo(code);\r\n      \r\n      // 從本地資料庫取得股票名稱（如果有）\r\n      const localInfo = this.getStockInfoFromLocalDB(code);\r\n      \r\n      const result: StockInfo = {\r\n        code,\r\n        name: localInfo?.name || code,\r\n        price,\r\n        type: localInfo?.type,\r\n        source: 'Yahoo'\r\n      };\r\n      console.log(`✅ Yahoo Finance API 搜尋成功: ${code}`);\r\n      return result;\r\n    } catch (error) {\r\n      console.warn(`❌ Yahoo Finance API 搜尋失敗: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n    \r\n    // 3. 嘗試本地資料庫 (最低優先級)\r\n    console.log(`[3/3] 嘗試本地資料庫搜尋: ${code}`);\r\n    const localInfo = this.getStockInfoFromLocalDB(code);\r\n    if (localInfo) {\r\n      console.log(`✅ 本地資料庫搜尋成功: ${code}`);\r\n      return localInfo;\r\n    }\r\n    \r\n    // 4. 所有方法都失敗，拋出錯誤\r\n    console.error(`❌ 所有 API 都無法找到股票 ${code} 的資訊`);\r\n    throw new ApiError(`無法找到股票 ${code} 的資訊，所有資料來源都失敗`);\r\n  }\r\n  private async fetchFromTWSE(code: string): Promise<number> {\r\n    console.log(`證交所 API 查詢: ${code}`);\r\n    \r\n    // 判斷股票類型\r\n    const stockType = this.getStockType(code);\r\n    console.log(`股票類型: ${stockType}`);\r\n    \r\n    try {\r\n      switch (stockType) {\r\n        case 'listed': // 上市股票\r\n          return await this.fetchFromTWSEListed(code);\r\n        case 'otc': // 上櫃股票\r\n          return await this.fetchFromTPEx(code);\r\n        case 'emerging': // 興櫃股票\r\n          return await this.fetchFromEmerging(code);\r\n        case 'etf': // ETF\r\n          return await this.fetchFromETF(code);\r\n        default:\r\n          // 如果無法判斷類型，依序嘗試各個 API\r\n          return await this.fetchFromAllTWSE(code);\r\n      }\r\n    } catch (error) {\r\n      console.warn(`證交所 API 查詢失敗: ${error instanceof Error ? error.message : String(error)}`);\r\n      throw new ApiError(`證交所 API 查詢失敗: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 判斷股票類型\r\n   * @param code - 股票代碼\r\n   * @returns 股票類型\r\n   */\r\n  private getStockType(code: string): 'listed' | 'otc' | 'emerging' | 'etf' | 'unknown' {\r\n    // ETF (以 00 開頭)\r\n    if (/^00\\d+/.test(code)) return 'etf';\r\n    \r\n    // 上市股票 (1000-9999)\r\n    if (/^[1-9]\\d{3}$/.test(code)) return 'listed';\r\n    \r\n    // 上櫃股票 (4000-8999)\r\n    if (/^[4-8]\\d{3}$/.test(code)) return 'otc';\r\n    \r\n    return 'unknown';\r\n  }\r\n  \r\n  /**\r\n   * 從證交所取得上市股票價格\r\n   * @param code - 股票代碼\r\n   * @returns 股票價格\r\n   * @throws {ApiError} 當 API 呼叫失敗時\r\n   */\r\n  private async fetchFromTWSEListed(code: string): Promise<number> {\r\n    const today = new Date();\r\n    const dateStr = today.getFullYear() + \r\n                   String(today.getMonth() + 1).padStart(2, '0') + \r\n                   String(today.getDate()).padStart(2, '0');\r\n    \r\n    const twseUrl = `https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=json&date=${dateStr}&stockNo=${code}`;\r\n    \r\n    const response = await this.fetchWithTimeout(twseUrl, this.API_TIMEOUT);\r\n    \r\n    if (!response.ok) {\r\n      throw new ApiError(`TWSE API 錯誤: ${response.status}`, response.status);\r\n    }\r\n    \r\n    const data: TWSEApiResponse = await response.json();\r\n    \r\n    if (data.stat !== 'OK' || !data.data || data.data.length === 0) {\r\n      throw new ApiError('TWSE 無資料或股票代碼錯誤');\r\n    }\r\n    \r\n    // 取最新一天的資料\r\n    const latestData = data.data[data.data.length - 1];\r\n    const closePrice = parseFloat(latestData[6].replace(/,/g, '')); // 收盤價\r\n    \r\n    if (isNaN(closePrice) || closePrice <= 0) {\r\n      throw new ApiError('無效的價格資料');\r\n    }\r\n    \r\n    return closePrice;\r\n  }\r\n  \r\n  /**\r\n   * 從櫃買中心取得上櫃股票價格\r\n   * @param code - 股票代碼\r\n   * @returns 股票價格\r\n   * @throws {ApiError} 當 API 呼叫失敗時\r\n   */\r\n  private async fetchFromTPEx(code: string): Promise<number> {\r\n    const today = new Date();\r\n    const dateStr = today.getFullYear() + '/' + \r\n                   String(today.getMonth() + 1).padStart(2, '0') + '/' + \r\n                   String(today.getDate()).padStart(2, '0');\r\n    \r\n    const tpexUrl = `https://www.tpex.org.tw/web/stock/aftertrading/daily_close_quotes/stk_quote_result.php?l=zh-tw&d=${dateStr}&stkno=${code}`;\r\n    \r\n    const response = await this.fetchWithTimeout(tpexUrl, this.API_TIMEOUT);\r\n    \r\n    if (!response.ok) {\r\n      throw new ApiError(`TPEx API 錯誤: ${response.status}`, response.status);\r\n    }\r\n    \r\n    const data: any = await response.json();\r\n    \r\n    if (!data.aaData || data.aaData.length === 0) {\r\n      throw new ApiError('TPEx 無資料或股票代碼錯誤');\r\n    }\r\n    \r\n    const stockData = data.aaData[0];\r\n    const closePrice = parseFloat(stockData[2]);\r\n    \r\n    if (isNaN(closePrice) || closePrice <= 0) {\r\n      throw new ApiError('無效的價格資料');\r\n    }\r\n    \r\n    return closePrice;\r\n  }\r\n  \r\n  /**\r\n   * 從櫃買中心取得興櫃股票價格\r\n   * @param code - 股票代碼\r\n   * @returns 股票價格\r\n   * @throws {ApiError} 當 API 呼叫失敗時\r\n   */\r\n  private async fetchFromEmerging(code: string): Promise<number> {\r\n    // 興櫃股票通常也在櫃買中心的系統中\r\n    try {\r\n      return await this.fetchFromTPEx(code);\r\n    } catch (error) {\r\n      throw new ApiError(`興櫃股票查詢失敗: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 取得 ETF 價格\r\n   * @param code - 股票代碼\r\n   * @returns 股票價格\r\n   * @throws {ApiError} 當 API 呼叫失敗時\r\n   */\r\n  private async fetchFromETF(code: string): Promise<number> {\r\n    // ETF 可能在上市或上櫃\r\n    try {\r\n      // 先嘗試上市 ETF\r\n      return await this.fetchFromTWSEListed(code);\r\n    } catch (error) {\r\n      // 再嘗試上櫃 ETF\r\n      return await this.fetchFromTPEx(code);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 依序嘗試所有證交所 API\r\n   * @param code - 股票代碼\r\n   * @returns 股票價格\r\n   * @throws {ApiError} 當所有 API 都失敗時\r\n   */\r\n  private async fetchFromAllTWSE(code: string): Promise<number> {\r\n    const apis = [\r\n      { name: '上市', method: () => this.fetchFromTWSEListed(code) },\r\n      { name: '上櫃', method: () => this.fetchFromTPEx(code) },\r\n      { name: '興櫃', method: () => this.fetchFromEmerging(code) }\r\n    ];\r\n    \r\n    for (const api of apis) {\r\n      try {\r\n        console.log(`嘗試 ${api.name} API: ${code}`);\r\n        const price = await api.method();\r\n        if (price > 0) {\r\n          console.log(`✅ ${api.name} API 成功: ${code}`);\r\n          return price;\r\n        }\r\n      } catch (error) {\r\n        console.warn(`❌ ${api.name} API 失敗: ${error instanceof Error ? error.message : String(error)}`);\r\n        continue;\r\n      }\r\n    }\r\n    \r\n    throw new ApiError('所有證交所 API 都無法找到此股票');\r\n  }\r\n  \r\n  /**\r\n   * 帶逾時的 fetch 請求\r\n   * @param url - 請求 URL\r\n   * @param timeout - 逾時時間（毫秒）\r\n   * @returns Response 物件\r\n   * @throws {ApiError} 當請求失敗或逾時時\r\n   */\r\n  private async fetchWithTimeout(url: string, timeout: number): Promise<Response> {\r\n    const controller = new AbortController();\r\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\r\n    \r\n    try {\r\n      const response = await fetch(url, {\r\n        signal: controller.signal\r\n      });\r\n      clearTimeout(timeoutId);\r\n      return response;\r\n    } catch (error) {\r\n      clearTimeout(timeoutId);\r\n      if (error instanceof Error && error.name === 'AbortError') {\r\n        throw new ApiError('請求逾時');\r\n      }\r\n      throw new ApiError(`請求失敗: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 從 Yahoo Finance API 取得股價\r\n   * @param code - 股票代碼\r\n   * @returns 股票價格\r\n   * @throws {ApiError} 當 API 呼叫失敗時\r\n   */\r\n  private async fetchFromYahoo(code: string): Promise<number> {\r\n    const symbol = this.formatTaiwanSymbol(code);\r\n    \r\n    // 使用 CORS 代理\r\n    const corsProxy = 'https://api.allorigins.win/raw?url=';\r\n    const yahooUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`;\r\n    \r\n    try {\r\n      const response = await this.fetchWithTimeout(\r\n        corsProxy + encodeURIComponent(yahooUrl),\r\n        this.API_TIMEOUT\r\n      );\r\n      \r\n      if (!response.ok) {\r\n        throw new ApiError(`Yahoo Finance API 錯誤: HTTP ${response.status}`, response.status);\r\n      }\r\n      \r\n      const data: YahooFinanceResponse = await response.json();\r\n      const result = (data as any).chart?.result?.[0];\r\n      \r\n      if (!result) {\r\n        throw new ApiError('Yahoo Finance 回應格式無效');\r\n      }\r\n      \r\n      const meta = result.meta;\r\n      const price = meta.regularMarketPrice || meta.previousClose;\r\n      \r\n      if (!price || price <= 0) {\r\n        throw new ApiError('無法從 Yahoo Finance 取得有效價格');\r\n      }\r\n      \r\n      return price;\r\n    } catch (error) {\r\n      if (error instanceof ApiError) {\r\n        throw error;\r\n      }\r\n      throw new ApiError(`Yahoo Finance API 呼叫失敗: ${error instanceof Error ? error.message : String(error)}`);\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 將台股代碼轉換為 Yahoo Finance 格式\r\n   * @param code - 股票代碼\r\n   * @returns Yahoo Finance 格式的股票代碼\r\n   */\r\n  private formatTaiwanSymbol(code: string): string {\r\n    // 台股代碼轉換為 Yahoo Finance 格式\r\n    // 一般股票和 ETF 都加上 .TW 後綴\r\n    if (/^\\d{4,6}$/.test(code)) {\r\n      return `${code}.TW`;\r\n    }\r\n    return `${code}.TW`;\r\n  }\r\n\r\n}\r\n"],"names":["StorageService","__publicField","data","json","error","StorageError","MigrationService","oldData","newData","rollbackError","migrationTime","accountMap","accounts","accountName","accountId","defaultAccountId","stocks","dividends","oldStock","stockId","newStock","oldDividend","dividend","stock","index","acc","account","c","r","dateStr","date","StockApiService","code","cached","result","stockData","price","localPrice","ApiError","localInfo","stockType","today","twseUrl","response","latestData","closePrice","tpexUrl","apis","api","url","timeout","controller","timeoutId","symbol","corsProxy","yahooUrl","_b","_a","meta"],"mappings":"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"}