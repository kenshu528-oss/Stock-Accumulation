---
inclusion: always
---

# 版本發布規則 (Version Release Rules)

## 🎯 目標
確保每次版本發布都遵循標準流程，避免遺漏重要步驟。

## 📋 強制檢查清單

### 發版前必須完成的項目：

#### 1. 版本號更新 (10項)
- [ ] `src/script.js` - 註釋版本號
- [ ] `src/script.js` - showVersionInfo() 版本號  
- [ ] `src/script.js` - console.log 版本號 (2處)
- [ ] `src/version.js` - currentVersion 變數
- [ ] `src/version.js` - versionHistory 新增記錄
- [ ] `index.html` - 頁面標題版本號
- [ ] `netlify-upload/index.html` - Netlify版本號
- [ ] `netlify-upload/src/version.js` - Netlify版本檔
- [ ] `README.md` - 開發者資訊版本號和日期

#### 2. 功能測試 (10項)
- [ ] 新增股票功能
- [ ] 刪除股票功能  
- [ ] 編輯股數功能
- [ ] 編輯成本價功能
- [ ] 股價更新功能
- [ ] 帳戶管理功能
- [ ] 股息管理功能
- [ ] Action按鈕顯示
- [ ] 隱私模式切換
- [ ] 深色模式切換

#### 3. 介面檢查 (7項)
- [ ] 按鈕間距適當
- [ ] 文字完全中文化
- [ ] 圖示正常顯示
- [ ] 亮色模式正常
- [ ] 深色模式正常
- [ ] 手機響應式正常
- [ ] 平板響應式正常

#### 4. 代碼品質 (5項)
- [ ] 無JavaScript錯誤
- [ ] 無CSS錯誤
- [ ] 無HTML錯誤
- [ ] 控制台無錯誤
- [ ] 新功能有註釋

#### 5. 文檔更新 (4項)
- [ ] README.md 功能列表更新
- [ ] README.md 版本歷史更新
- [ ] 新功能使用說明
- [ ] 檢查清單本身更新

**總計：36項檢查項目**

## 🛠️ 自動化工具

### 1. 版本檢查腳本
```bash
# 檢查版本號一致性
node scripts/version-check.js
```

### 2. 版本更新腳本  
```bash
# 自動更新所有檔案的版本號
bash scripts/version-update.sh 1.2.2.0018
```

### 3. 發版前檢查工具
```bash
# 開啟互動式檢查工具
open scripts/pre-release-check.html
```

## 🔄 標準發版流程

### Phase 1: 準備階段
1. 確定版本號（遵循語義化版本）
2. 整理更新內容清單
3. 執行版本檢查腳本

### Phase 2: 更新階段  
1. 使用自動化腳本更新版本號
2. 手動更新版本歷史記錄
3. 更新相關文檔

### Phase 3: 測試階段
1. 開啟發版前檢查工具
2. 逐項完成所有檢查
3. 確保通過率達到100%

### Phase 4: 發布階段
1. **🔴 等待用戶明確確認** - 必須獲得"可以發布"或"同意上傳"的明確指示
2. 提交所有變更
3. 建立版本標籤
4. 推送到遠端倉庫
5. 部署到生產環境

### Phase 5: 驗證階段
1. 驗證部署結果
2. 進行冒煙測試
3. 記錄發布結果

## ⚠️ 重要提醒

### 🚫 禁止未經確認的發布
- **絕對禁止** 在用戶明確同意前上傳到GitHub
- **絕對禁止** 在功能測試未通過前進行發布

### ✅ 發布前必須獲得用戶確認
- 用戶明確說"可以發布"或"同意上傳"
- 所有問題都已解決並經用戶驗證
- 功能測試100%通過用戶確認

### 🔢 版本號更新規則

#### 版本號分支管理
- **舊版系統 (archive/legacy-system)**: v1.2.2.XXXX 範圍
  - 用於維護和bug修正
  - 格式：v1.2.2.0001 ~ v1.2.2.9999
  - 不進行重大功能更新
  
- **新版系統 (主目錄 src/)**: v1.3.X.XXXX 範圍  
  - 用於新功能開發和重大更新
  - 格式：v1.3.0.0001 ~ v1.3.9.9999
  - 支援完整的新架構和模組化設計

#### 版本號更新原則
- **每次bug修正都必須更新版本號**
- 格式：v1.2.3.xxxx (xxxx為4位數遞增，0001-9999)
- bug修正後立即更新版本號，無需等待用戶確認
- 只有GitHub上傳需要用戶明確同意

#### 版本號選擇規則
- 修正舊版系統問題 → 使用 v1.2.2.XXXX
- 開發新功能或重大更新 → 使用 v1.3.X.XXXX
- 絕對不能混用版本號範圍

## 🔍 股票搜尋順序規則 (軟體核心邏輯)

### 強制搜尋順序 - 任何情況下都不可更改
1. **證交所API** (TWSE/TPEx) - 最高優先級
   - 支援上市、上櫃、興櫃、ETF
   - 提供最準確的即時資料
   
2. **Yahoo Finance API** - 次優先級  
   - 作為證交所API的備援
   - 支援國際股票查詢
   
3. **本地資料庫** - 最低優先級
   - 僅在所有API都失敗時使用
   - 主要用於提供中文名稱對照
   
4. **顯示錯誤** - 最終處理
   - 所有方法都失敗時的錯誤處理

### ⚠️ 搜尋規則禁令 (絕對不可違反)
- **絕對禁止** 為了速度而優先使用本地資料庫
- **絕對禁止** 跳過證交所API直接使用其他方法  
- **絕對禁止** 改變 1→2→3→4 的搜尋順序
- **絕對禁止** 因為API失敗率高而調整順序

### 實作要求
- `searchStockByCode()` 必須按順序調用所有API
- `searchStockByName()` 必須按順序調用所有API  
- `refreshStockPrices()` 必須使用證交所API優先
- 本地資料庫僅用於中文名稱對照，不能作為主要資料源

## 💡 最小改動原則 (開發核心準則)

### 修改代碼時必須遵循
- **最小化修改範圍** - 只修改必要的部分，不做無關改動
- **保持現有結構** - 不重構已經運作正常的代碼
- **優先隱藏而非刪除** - 使用 `display: none` 而非刪除HTML元素
- **重用現有ID和類別** - 不改變現有的DOM元素ID
- **保持向後相容** - 確保現有功能不受影響

### 禁止的大幅修改
- **絕對禁止** 重寫整個函數（除非完全無法運作）
- **絕對禁止** 改變HTML結構（除非必要）
- **絕對禁止** 重命名現有的ID或類別名稱
- **絕對禁止** 刪除現有的DOM元素
- **絕對禁止** 大幅重構已運作的邏輯

### 推薦的修改方式
- 在現有函數中新增邏輯
- 使用CSS隱藏不需要的元素
- 重用現有的事件處理器
- 擴展現有的搜尋邏輯而非重寫
- 保持現有的變數名稱和結構

### 絕對不能跳過的步驟：
1. **每次bug修正立即更新版本號** - 使用v1.2.3.xxxxx格式
2. **用戶明確確認** - 必須獲得用戶明確同意才能發布到GitHub
3. **版本號一致性檢查** - 所有檔案版本號必須一致
4. **功能完整性測試** - 核心功能必須全部正常
5. **文檔同步更新** - 版本歷史和說明必須更新
6. **備份確認** - 發版前必須有完整備份

### 常見錯誤預防：
1. **版本號不一致** - 使用自動化腳本避免
2. **功能測試不完整** - 使用檢查清單確保覆蓋
3. **文檔更新遺漏** - 將文檔更新納入強制檢查
4. **回滾準備不足** - 每次發版前都要備份

## 📊 品質指標

### 發版品質要求：
- **檢查清單完成率**: 100%
- **自動化測試通過率**: 100%  
- **文檔更新完整性**: 100%
- **版本號一致性**: 100%

### 發版頻率建議：
- **Major版本**: 每季度1次
- **Minor版本**: 每月1-2次
- **Patch版本**: 每週1-2次  
- **Build版本**: 每日1-3次

## 🎯 持續改進

### 定期檢討：
1. **每月檢討** - 發版流程效率
2. **每季檢討** - 檢查清單完整性
3. **每年檢討** - 整體發版策略

### 工具優化：
1. **自動化程度提升** - 減少手動操作
2. **檢查工具完善** - 提高檢查準確性
3. **流程標準化** - 確保一致性

---

**記住：沒有用戶明確同意，絕不發布！寧可多花時間檢查，也不要匆忙發布有問題的版本！**