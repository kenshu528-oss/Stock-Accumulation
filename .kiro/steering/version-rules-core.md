---
inclusion: always
---

# 版本發布核心規則

## 🔢 版本號分支管理

### 舊版系統 (archive/legacy-system)
- **版本範圍**: v1.2.2.XXXX (0001-9999)
- **用途**: 維護、bug修正、小幅改進
- **檔案位置**: archive/legacy-system/src/
- **更新原則**: 每次修正立即遞增建置號

### 新版系統 (主目錄)  
- **版本範圍**: v1.3.X.XXXX (0001-9999)
- **用途**: 新功能開發、重大更新、架構改進
- **檔案位置**: src/、index.html、README.md
- **更新原則**: 功能完成後更新次版本號

### ⚠️ 版本號使用規則
- **絕對禁止** 混用版本號範圍
- **絕對禁止** 舊版使用1.3.X版本號  
- **絕對禁止** 新版使用1.2.2版本號
- 修正哪個系統就用對應的版本號

## 🔍 股票搜尋順序規則 (強制遵循)

### 搜尋順序 - 絕對不可更改
1. **證交所API** (最高優先級)
2. **Yahoo Finance API** (次優先級)  
3. **本地資料庫** (最低優先級)
4. **顯示錯誤** (所有方法都失敗)

### ⚠️ 搜尋規則禁令
- **絕對禁止** 優先使用本地資料庫
- **絕對禁止** 跳過證交所API直接使用其他方法
- **絕對禁止** 改變搜尋順序
- **絕對禁止** 因為速度考量而違反順序

### 搜尋邏輯實作要求
- 每個搜尋函數都必須按順序嘗試所有API
- API失敗時必須記錄錯誤並繼續下一個
- 只有在所有API都失敗時才使用本地資料庫
- 本地資料庫僅用於提供中文名稱，不能作為主要搜尋來源

## 💡 最小改動原則

### 開發時必須遵循
- **最小化修改** - 只改必要部分
- **保持結構** - 不重構正常運作的代碼  
- **隱藏不刪除** - 用 `display: none` 而非刪除
- **重用ID** - 不改變現有DOM元素ID
- **向後相容** - 確保現有功能正常

### 禁止大幅修改
- **禁止** 重寫整個函數
- **禁止** 改變HTML結構
- **禁止** 重命名ID或類別
- **禁止** 刪除DOM元素
- **禁止** 大幅重構邏輯

## 🎯 強制檢查清單（36項）

### 版本號更新 (10項) - 格式：v1.2.3.xxxx (4位數)
- [ ] src/script.js (3處)
- [ ] src/version.js (2處) 
- [ ] index.html (1處)
- [ ] netlify-upload/ (2處)
- [ ] README.md (2處)

### 功能測試 (10項)
- [ ] 基本功能 (新增/刪除/編輯)
- [ ] 帳戶管理
- [ ] 股息管理
- [ ] Action按鈕
- [ ] 隱私/深色模式

### 介面檢查 (7項)
- [ ] 間距/中文化/圖示
- [ ] 亮色/深色模式
- [ ] 響應式設計

### 代碼品質 (5項)
- [ ] 無JS/CSS/HTML錯誤
- [ ] 控制台無錯誤
- [ ] 新功能有註釋

### 文檔更新 (4項)
- [ ] README.md更新
- [ ] 版本歷史
- [ ] 使用說明

## ⚠️ 重要：用戶確認機制

### 🚫 禁止未經確認的發布
- **絕對禁止** 在用戶明確同意前上傳到GitHub
- **絕對禁止** 在問題未完全解決前更新版本號
- **絕對禁止** 在功能測試未通過前進行發布

### ✅ 發布前必須獲得用戶確認
- 用戶明確說"可以發布"或"同意上傳"
- 所有問題都已解決並經用戶驗證
- 功能測試100%通過用戶確認

**記住：沒有用戶同意，絕不發布！**