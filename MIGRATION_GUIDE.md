# v1.2.X â†’ v1.3.X é·ç§»æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—å°‡å”åŠ©æ‚¨å¾ v1.2.X ç‰ˆæœ¬é·ç§»åˆ° v1.3.X TypeScript æ¨¡çµ„åŒ–æ¶æ§‹ç‰ˆæœ¬ã€‚v1.3.X æä¾›äº†æ›´å¥½çš„æ•ˆèƒ½ã€å¯ç¶­è­·æ€§å’Œé–‹ç™¼é«”é©—ã€‚

## ğŸ¯ é·ç§»å‰æº–å‚™

### 1. å‚™ä»½ç¾æœ‰è³‡æ–™
åœ¨é–‹å§‹é·ç§»å‰ï¼Œå»ºè­°å…ˆå‚™ä»½æ‚¨çš„ v1.2.X è³‡æ–™ï¼š

```javascript
// åœ¨ v1.2.X çš„ç€è¦½å™¨æ§åˆ¶å°ä¸­åŸ·è¡Œ
const v12Data = localStorage.getItem('stockPortfolio_v1.2');
console.log('v1.2.X è³‡æ–™:', v12Data);

// è¤‡è£½è¼¸å‡ºçš„è³‡æ–™ä¸¦å„²å­˜åˆ°æ–‡å­—æª”æ¡ˆ
```

### 2. ç¢ºèªç’°å¢ƒéœ€æ±‚
- **Node.js** >= 18.0.0
- **npm** >= 9.0.0
- ç¾ä»£ç€è¦½å™¨ï¼ˆChrome >= 80, Firefox >= 78, Safari >= 14ï¼‰

## ğŸ”„ è‡ªå‹•é·ç§»ï¼ˆæ¨è–¦ï¼‰

### æ­¥é©Ÿ 1ï¼šå•Ÿå‹• v1.3.X
```bash
# å®‰è£ä¾è³´
npm install

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev
```

### æ­¥é©Ÿ 2ï¼šé·ç§»æç¤º
ç•¶ç³»çµ±åµæ¸¬åˆ° v1.2.X è³‡æ–™æ™‚ï¼Œæœƒè‡ªå‹•é¡¯ç¤ºé·ç§»å°è©±æ¡†ï¼š

```
åµæ¸¬åˆ° v1.2.X ç‰ˆæœ¬çš„è³‡æ–™ã€‚

æ˜¯å¦è¦å°‡è³‡æ–™é·ç§»åˆ° v1.3.Xï¼Ÿ

âœ“ é·ç§»å¾Œæœƒä¿ç•™èˆŠç‰ˆè³‡æ–™
âœ“ å¯ä»¥éš¨æ™‚å›åˆ°èˆŠç‰ˆä½¿ç”¨
âœ“ æ–°ç‰ˆæä¾›æ›´å¥½çš„æ•ˆèƒ½å’ŒåŠŸèƒ½

é¸æ“‡ã€Œå–æ¶ˆã€å°‡å¾ç©ºç™½ç‹€æ…‹é–‹å§‹
```

### æ­¥é©Ÿ 3ï¼šåŸ·è¡Œé·ç§»
é»æ“Šã€Œç¢ºå®šã€å¾Œï¼Œç³»çµ±æœƒï¼š
1. è®€å– v1.2.X è³‡æ–™
2. è½‰æ›è³‡æ–™æ ¼å¼
3. é©—è­‰è½‰æ›çµæœ
4. å„²å­˜åˆ° v1.3.X
5. ä¿ç•™ v1.2.X è³‡æ–™

### æ­¥é©Ÿ 4ï¼šé©—è­‰çµæœ
é·ç§»å®Œæˆå¾Œï¼Œæª¢æŸ¥ï¼š
```javascript
// æª¢æŸ¥æ–°ç‰ˆè³‡æ–™
const v13Data = window.app.storageService.load();
console.log('v1.3.X è³‡æ–™:', v13Data);

// æª¢æŸ¥èˆŠç‰ˆè³‡æ–™æ˜¯å¦ä¿ç•™
const v12Data = localStorage.getItem('stockPortfolio_v1.2');
console.log('v1.2.X è³‡æ–™æ˜¯å¦ä¿ç•™:', v12Data !== null);
```

## ğŸ› ï¸ æ‰‹å‹•é·ç§»

å¦‚æœè‡ªå‹•é·ç§»å¤±æ•—ï¼Œå¯ä»¥æ‰‹å‹•åŸ·è¡Œï¼š

### æ­¥é©Ÿ 1ï¼šåŒ¯å‡º v1.2.X è³‡æ–™
åœ¨ v1.2.X çš„ç€è¦½å™¨æ§åˆ¶å°ä¸­ï¼š
```javascript
// åŒ¯å‡ºè³‡æ–™
const data = localStorage.getItem('stockPortfolio_v1.2');
const blob = new Blob([data], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = 'v1.2-backup.json';
a.click();
```

### æ­¥é©Ÿ 2ï¼šåœ¨ v1.3.X ä¸­åŒ¯å…¥
```javascript
// åœ¨ v1.3.X çš„æ§åˆ¶å°ä¸­åŸ·è¡Œ
const migrationService = window.app.migrationService;

// æ‰‹å‹•è¨­å®šèˆŠç‰ˆè³‡æ–™ï¼ˆå°‡åŒ¯å‡ºçš„è³‡æ–™è²¼ä¸Šï¼‰
localStorage.setItem('stockPortfolio_v1.2', 'æ‚¨çš„v1.2.Xè³‡æ–™');

// åŸ·è¡Œé·ç§»
const result = migrationService.migrate();
console.log('é·ç§»çµæœ:', result);
```

## ğŸ“Š è³‡æ–™æ ¼å¼å°ç…§

### v1.2.X æ ¼å¼
```javascript
{
  "stocks": [
    {
      "stockCode": "2330",
      "stockName": "å°ç©é›»",
      "quantity": 1000,
      "buyPrice": 500,
      "currentPrice": 550,
      "buyDate": "2024-01-15",
      "account": "å¸³æˆ¶1",
      "dividends": [
        {
          "date": "2024-06-15",
          "amount": 2.5
        }
      ]
    }
  ],
  "accounts": ["å¸³æˆ¶1", "å¸³æˆ¶2"]
}
```

### v1.3.X æ ¼å¼
```typescript
{
  "version": "1.3.0",
  "accounts": [
    {
      "id": "account_uuid",
      "name": "å¸³æˆ¶1",
      "createdAt": "2025-01-02T..."
    }
  ],
  "stocks": [
    {
      "id": "stock_uuid",
      "code": "2330",
      "name": "å°ç©é›»",
      "shares": 1000,
      "costPrice": 500,
      "currentPrice": 550,
      "purchaseDate": "2024-01-15T00:00:00.000Z",
      "accountId": "account_uuid",
      "lastUpdated": "2025-01-02T...",
      "dataSource": "Local"
    }
  ],
  "dividends": [
    {
      "id": "dividend_uuid",
      "stockId": "stock_uuid",
      "exDividendDate": "2024-06-15T00:00:00.000Z",
      "dividendPerShare": 2.5,
      "totalDividend": 2500,
      "createdAt": "2025-01-02T..."
    }
  ],
  "settings": { ... },
  "metadata": { ... }
}
```

## ğŸ” é·ç§»é©—è­‰

### æª¢æŸ¥æ¸…å–®
- [ ] è‚¡ç¥¨æ•¸é‡ç›¸åŒ
- [ ] å¸³æˆ¶æ•¸é‡ç›¸åŒ
- [ ] è‚¡æ¯è¨˜éŒ„å®Œæ•´
- [ ] æ ¸å¿ƒè³‡è¨Šä¸€è‡´ï¼ˆä»£ç¢¼ã€åç¨±ã€æŒè‚¡æ•¸ã€æˆæœ¬åƒ¹ï¼‰
- [ ] èˆŠç‰ˆè³‡æ–™ä¿ç•™
- [ ] æ–°ç‰ˆåŠŸèƒ½æ­£å¸¸

### é©—è­‰è…³æœ¬
```javascript
// åœ¨ v1.3.X æ§åˆ¶å°ä¸­åŸ·è¡Œ
function validateMigration() {
  const v12Raw = localStorage.getItem('stockPortfolio_v1.2');
  const v13Data = window.app.storageService.load();
  
  if (!v12Raw || !v13Data) {
    console.error('âŒ è³‡æ–™ä¸å®Œæ•´');
    return false;
  }
  
  const v12Data = JSON.parse(v12Raw);
  
  // æª¢æŸ¥è‚¡ç¥¨æ•¸é‡
  const v12StockCount = v12Data.stocks?.length || 0;
  const v13StockCount = v13Data.stocks?.length || 0;
  
  console.log(`è‚¡ç¥¨æ•¸é‡: v1.2.X=${v12StockCount}, v1.3.X=${v13StockCount}`);
  
  if (v12StockCount !== v13StockCount) {
    console.error('âŒ è‚¡ç¥¨æ•¸é‡ä¸ä¸€è‡´');
    return false;
  }
  
  // æª¢æŸ¥å¸³æˆ¶æ•¸é‡
  const v12AccountCount = v12Data.accounts?.length || 0;
  const v13AccountCount = v13Data.accounts?.length || 0;
  
  console.log(`å¸³æˆ¶æ•¸é‡: v1.2.X=${v12AccountCount}, v1.3.X=${v13AccountCount}`);
  
  if (v12AccountCount !== v13AccountCount) {
    console.error('âŒ å¸³æˆ¶æ•¸é‡ä¸ä¸€è‡´');
    return false;
  }
  
  console.log('âœ… é·ç§»é©—è­‰é€šé');
  return true;
}

// åŸ·è¡Œé©—è­‰
validateMigration();
```

## ğŸš¨ å¸¸è¦‹å•é¡Œ

### Q1: é·ç§»å¤±æ•—æ€éº¼è¾¦ï¼Ÿ
**A**: 
1. æª¢æŸ¥æ§åˆ¶å°éŒ¯èª¤è¨Šæ¯
2. ç¢ºèª v1.2.X è³‡æ–™æ ¼å¼æ­£ç¢º
3. å˜—è©¦æ‰‹å‹•é·ç§»
4. è¯çµ¡æŠ€è¡“æ”¯æ´

### Q2: é·ç§»å¾ŒèˆŠç‰ˆè³‡æ–™æœƒè¢«åˆªé™¤å—ï¼Ÿ
**A**: ä¸æœƒã€‚v1.3.X çš„è¨­è¨ˆåŸå‰‡æ˜¯ä¿ç•™èˆŠç‰ˆè³‡æ–™ï¼Œæ‚¨å¯ä»¥éš¨æ™‚å›åˆ° v1.2.X ä½¿ç”¨ã€‚

### Q3: å¯ä»¥åŒæ™‚ä½¿ç”¨å…©å€‹ç‰ˆæœ¬å—ï¼Ÿ
**A**: å¯ä»¥ã€‚å…©å€‹ç‰ˆæœ¬çš„è³‡æ–™å®Œå…¨éš”é›¢ï¼Œå¯ä»¥ä¸¦å­˜ä½¿ç”¨ã€‚

### Q4: é·ç§»å¾Œç™¼ç¾è³‡æ–™éŒ¯èª¤æ€éº¼è¾¦ï¼Ÿ
**A**: 
1. èˆŠç‰ˆè³‡æ–™ä»ç„¶å­˜åœ¨ï¼Œå¯ä»¥é‡æ–°é·ç§»
2. ä½¿ç”¨æ‰‹å‹•åŒ¯å…¥åŠŸèƒ½
3. æˆ–ç¹¼çºŒä½¿ç”¨ v1.2.X

### Q5: v1.3.X çš„æŒ‰éˆ•æ²’æœ‰åŠŸèƒ½ï¼Ÿ
**A**: v1.3.X ç›®å‰å°ˆæ³¨æ–¼å¾Œç«¯æ¶æ§‹ï¼ŒUI æ•´åˆæ˜¯ä¸‹ä¸€éšæ®µã€‚æ‚¨å¯ä»¥ï¼š
1. åœ¨æ§åˆ¶å°ä¸­æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½
2. ç­‰å¾… UI æ•´åˆå®Œæˆ
3. æš«æ™‚ä½¿ç”¨ v1.2.X

## ğŸ”„ å›é€€åˆ° v1.2.X

å¦‚æœéœ€è¦å›åˆ°èˆŠç‰ˆï¼š

### æ–¹æ³• 1ï¼šä½¿ç”¨ archive ç‰ˆæœ¬
```bash
# é–‹å•Ÿ archive/legacy-system/index.html
```

### æ–¹æ³• 2ï¼šæ¢å¾©èˆŠç‰ˆåˆ°ä¸»ç›®éŒ„
```bash
# å‚™ä»½ v1.3.X
mv src src-v1.3-backup
mv index.html index-v1.3-backup.html

# æ¢å¾© v1.2.X
cp -r archive/legacy-system/* .
```

## ğŸ“‹ é·ç§»æª¢æŸ¥æ¸…å–®

### é·ç§»å‰
- [ ] å‚™ä»½ v1.2.X è³‡æ–™
- [ ] ç¢ºèªç’°å¢ƒéœ€æ±‚
- [ ] å®‰è£ Node.js å’Œ npm

### é·ç§»ä¸­
- [ ] åŸ·è¡Œ `npm install`
- [ ] åŸ·è¡Œ `npm run dev`
- [ ] ç¢ºèªé·ç§»æç¤ºå‡ºç¾
- [ ] é¸æ“‡é·ç§»é¸é …

### é·ç§»å¾Œ
- [ ] é©—è­‰è‚¡ç¥¨æ•¸é‡
- [ ] é©—è­‰å¸³æˆ¶æ•¸é‡
- [ ] é©—è­‰è‚¡æ¯è¨˜éŒ„
- [ ] æ¸¬è©¦æ ¸å¿ƒåŠŸèƒ½
- [ ] ç¢ºèªèˆŠç‰ˆè³‡æ–™ä¿ç•™

### é©—è­‰åŠŸèƒ½
- [ ] å¸³æˆ¶ç®¡ç†åŠŸèƒ½
- [ ] è‚¡ç¥¨ CRUD æ“ä½œ
- [ ] è‚¡åƒ¹æ›´æ–°åŠŸèƒ½
- [ ] æŠ•è³‡çµ„åˆçµ±è¨ˆ
- [ ] è‚¡æ¯ç®¡ç†åŠŸèƒ½

## ğŸŠ é·ç§»å®Œæˆ

æ­å–œï¼æ‚¨å·²æˆåŠŸé·ç§»åˆ° v1.3.X TypeScript æ¨¡çµ„åŒ–æ¶æ§‹ã€‚

### æ–°åŠŸèƒ½é«”é©—
- åœ¨æ§åˆ¶å°ä¸­æ¸¬è©¦æ‰€æœ‰ç®¡ç†å™¨åŠŸèƒ½
- é«”é©—å³æ™‚è‚¡åƒ¹ API
- ä½¿ç”¨æ–°çš„æŠ•è³‡çµ„åˆçµ±è¨ˆåŠŸèƒ½
- äº«å—æ›´å¥½çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒ

### ä¸‹ä¸€æ­¥
- ç­‰å¾… UI æ•´åˆå®Œæˆ
- å­¸ç¿’æ–°çš„ API ä½¿ç”¨æ–¹å¼
- åƒèˆ‡æ¸¬è©¦å’Œåé¥‹
- äº«å—ç¾ä»£åŒ–çš„é–‹ç™¼é«”é©—

---

**éœ€è¦å”åŠ©ï¼Ÿ** è«‹æŸ¥çœ‹ [ç–‘é›£æ’è§£æŒ‡å—](TROUBLESHOOTING_GUIDE.md) æˆ–è¯çµ¡æŠ€è¡“æ”¯æ´ã€‚