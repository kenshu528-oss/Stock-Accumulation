# v1.3.X æ¶æ§‹æ¸¬è©¦æŒ‡å—

## ç›®å‰ç‹€æ…‹

âœ… **å·²å®Œæˆçš„ä»»å‹™**ï¼š
- ä»»å‹™ 1-12ï¼šæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å¯¦ä½œ
- ä»»å‹™ 13ï¼šæ‡‰ç”¨ç¨‹å¼å…¥å£å·²å»ºç«‹
- TypeScript æ¶æ§‹å®Œæ•´
- æ‰€æœ‰ç®¡ç†å™¨å’Œæœå‹™å·²å¯¦ä½œ

## æ¸¬è©¦æ–¹æ³•

### æ–¹æ³• 1ï¼šä½¿ç”¨ Vite é–‹ç™¼ä¼ºæœå™¨ï¼ˆæ¨è–¦ï¼‰

é€™æ˜¯æœ€ä½³çš„é–‹ç™¼å’Œæ¸¬è©¦æ–¹å¼ï¼Œæ”¯æ´ç†±æ¨¡çµ„æ›¿æ›å’Œ TypeScript å³æ™‚ç·¨è­¯ã€‚

#### å‰ç½®éœ€æ±‚
1. å®‰è£ Node.jsï¼ˆv18 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
   - ä¸‹è¼‰ï¼šhttps://nodejs.org/
   - é¸æ“‡ LTS ç‰ˆæœ¬

#### æ­¥é©Ÿ

1. **å®‰è£ä¾è³´**ï¼ˆé¦–æ¬¡åŸ·è¡Œï¼‰ï¼š
   ```bash
   npm install
   ```

2. **å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨**ï¼š
   ```bash
   npm run dev
   ```
   
   é€™æœƒï¼š
   - å•Ÿå‹• Vite é–‹ç™¼ä¼ºæœå™¨ï¼ˆé è¨­ http://localhost:3000ï¼‰
   - è‡ªå‹•ç·¨è­¯ TypeScript
   - æ”¯æ´ç†±æ¨¡çµ„æ›¿æ›ï¼ˆä¿®æ”¹ä»£ç¢¼å¾Œè‡ªå‹•é‡æ–°è¼‰å…¥ï¼‰
   - è‡ªå‹•é–‹å•Ÿç€è¦½å™¨

3. **é–‹å•Ÿç€è¦½å™¨**ï¼š
   - å¦‚æœæ²’æœ‰è‡ªå‹•é–‹å•Ÿï¼Œæ‰‹å‹•å‰å¾€ http://localhost:3000
   - é–‹å•Ÿé–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰æŸ¥çœ‹æ§åˆ¶å°è¼¸å‡º

#### é æœŸçµæœ

åœ¨ç€è¦½å™¨æ§åˆ¶å°ä¸­ï¼Œæ‚¨æ‡‰è©²çœ‹åˆ°ï¼š

```
ğŸš€ å•Ÿå‹• v1.3.X æ¶æ§‹æ‡‰ç”¨ç¨‹å¼...
=== v1.3.X æ¶æ§‹æ‡‰ç”¨ç¨‹å¼å•Ÿå‹• ===
ç‰ˆæœ¬ï¼šv1.3.0.0001
åˆå§‹åŒ–æ™‚é–“ï¼š2025-01-02T...
ğŸ“¦ åˆå§‹åŒ–æœå‹™å±¤...
  âœ“ StorageService å·²åˆå§‹åŒ–
  âœ“ MigrationService å·²åˆå§‹åŒ–
  âœ“ StockApiService å·²åˆå§‹åŒ–
âœ… æœå‹™å±¤åˆå§‹åŒ–å®Œæˆ
ğŸ”„ æª¢æŸ¥è³‡æ–™é·ç§»éœ€æ±‚...
âœ“ ç„¡ç¾æœ‰è³‡æ–™ï¼Œå¾ç©ºç™½ç‹€æ…‹é–‹å§‹
ğŸ“¦ åˆå§‹åŒ–ç®¡ç†å™¨å±¤...
  âœ“ StockManager å·²åˆå§‹åŒ–
  âœ“ AccountManager å·²åˆå§‹åŒ–
  âœ“ DividendManager å·²åˆå§‹åŒ–
  âœ“ PortfolioManager å·²åˆå§‹åŒ–
âœ… ç®¡ç†å™¨å±¤åˆå§‹åŒ–å®Œæˆ
ğŸŒ æš´éœ²ç®¡ç†å™¨åˆ°å…¨åŸŸ...
âœ… ç®¡ç†å™¨å·²æš´éœ²åˆ° window.app
âœ… æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å®Œæˆ
=================================
ğŸ“¢ å·²è§¸ç™¼ appReady äº‹ä»¶
```

### æ–¹æ³• 2ï¼šå»ºç½®ç”Ÿç”¢ç‰ˆæœ¬

å»ºç½®éœæ…‹æª”æ¡ˆï¼Œå¯ä»¥éƒ¨ç½²åˆ°ä»»ä½•ç¶²é ä¼ºæœå™¨ã€‚

#### æ­¥é©Ÿ

1. **å»ºç½®å°ˆæ¡ˆ**ï¼š
   ```bash
   npm run build
   ```
   
   é€™æœƒï¼š
   - ç·¨è­¯ TypeScript ç‚º JavaScript
   - æ‰“åŒ…æ‰€æœ‰è³‡æº
   - æœ€å°åŒ–ä»£ç¢¼
   - è¼¸å‡ºåˆ° `dist/` ç›®éŒ„

2. **é è¦½å»ºç½®çµæœ**ï¼š
   ```bash
   npm run preview
   ```
   
   é€™æœƒå•Ÿå‹•ä¸€å€‹æœ¬åœ°ä¼ºæœå™¨é è¦½å»ºç½®å¾Œçš„æª”æ¡ˆã€‚

3. **éƒ¨ç½²**ï¼š
   - å°‡ `dist/` ç›®éŒ„çš„å…§å®¹ä¸Šå‚³åˆ°ç¶²é ä¼ºæœå™¨
   - æˆ–ä½¿ç”¨ Netlify Drop éƒ¨ç½²

### æ–¹æ³• 3ï¼šæª¢æŸ¥ TypeScript ç·¨è­¯

é©—è­‰æ‰€æœ‰ TypeScript ä»£ç¢¼æ˜¯å¦æ­£ç¢ºã€‚

```bash
npm run type-check
```

é€™æœƒæª¢æŸ¥æ‰€æœ‰ TypeScript æª”æ¡ˆçš„å‹åˆ¥éŒ¯èª¤ï¼Œä½†ä¸æœƒç”¢ç”Ÿè¼¸å‡ºæª”æ¡ˆã€‚

### æ–¹æ³• 4ï¼šåŸ·è¡Œæ¸¬è©¦

åŸ·è¡Œå–®å…ƒæ¸¬è©¦å’Œå±¬æ€§æ¸¬è©¦ã€‚

```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
npm test

# åŸ·è¡Œæ¸¬è©¦ä¸¦é¡¯ç¤ºè¦†è“‹ç‡
npm run test:coverage

# ç›£è¦–æ¨¡å¼ï¼ˆè‡ªå‹•é‡æ–°åŸ·è¡Œæ¸¬è©¦ï¼‰
npm run test:watch
```

## æ¸¬è©¦åŠŸèƒ½

### 1. æ¸¬è©¦æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–

é–‹å•Ÿç€è¦½å™¨æ§åˆ¶å°ï¼ŒåŸ·è¡Œï¼š

```javascript
// æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼æ˜¯å¦å·²åˆå§‹åŒ–
console.log(window.app);

// æ‡‰è©²é¡¯ç¤ºï¼š
// {
//   storageService: StorageService {...},
//   stockApiService: StockApiService {...},
//   stockManager: StockManager {...},
//   accountManager: AccountManager {...},
//   dividendManager: DividendManager {...},
//   portfolioManager: PortfolioManager {...},
//   version: "v1.3.0.0001",
//   ...
// }
```

### 2. æ¸¬è©¦å¸³æˆ¶ç®¡ç†

```javascript
// å»ºç«‹å¸³æˆ¶
const account = window.app.accountManager.createAccount('æ¸¬è©¦å¸³æˆ¶');
console.log('å»ºç«‹å¸³æˆ¶:', account);

// å–å¾—æ‰€æœ‰å¸³æˆ¶
const accounts = window.app.accountManager.getAllAccounts();
console.log('æ‰€æœ‰å¸³æˆ¶:', accounts);
```

### 3. æ¸¬è©¦è‚¡ç¥¨ç®¡ç†

```javascript
// æ–°å¢è‚¡ç¥¨
const stock = await window.app.stockManager.addStock({
  code: '2330',
  name: 'å°ç©é›»',
  shares: 1000,
  costPrice: 500,
  currentPrice: 550,
  purchaseDate: '2024-01-15',
  accountId: accounts[0].id,
  dataSource: 'Local'
});
console.log('æ–°å¢è‚¡ç¥¨:', stock);

// å–å¾—æ‰€æœ‰è‚¡ç¥¨
const stocks = window.app.stockManager.getAllStocks();
console.log('æ‰€æœ‰è‚¡ç¥¨:', stocks);
```

### 4. æ¸¬è©¦è‚¡åƒ¹æ›´æ–°

```javascript
// æ›´æ–°å–®ä¸€è‚¡ç¥¨è‚¡åƒ¹
const updatedStock = await window.app.stockManager.updateStockPrice(stock.id);
console.log('æ›´æ–°å¾Œçš„è‚¡ç¥¨:', updatedStock);

// æ‰¹æ¬¡æ›´æ–°æ‰€æœ‰è‚¡åƒ¹
const result = await window.app.updateAllPrices();
console.log('æ‰¹æ¬¡æ›´æ–°çµæœ:', result);
```

### 5. æ¸¬è©¦æŠ•è³‡çµ„åˆçµ±è¨ˆ

```javascript
// å–å¾—æŠ•è³‡çµ„åˆæ‘˜è¦
const summary = window.app.getPortfolioSummary();
console.log('æŠ•è³‡çµ„åˆæ‘˜è¦:', summary);

// æ‡‰è©²é¡¯ç¤ºï¼š
// {
//   totalStats: { totalValue, totalCost, totalGain, ... },
//   accountStats: [...],
//   stockCount: 1,
//   accountCount: 1
// }
```

### 6. æ¸¬è©¦è³‡æ–™é·ç§»

å¦‚æœæ‚¨æœ‰ v1.2.X çš„è³‡æ–™ï¼š

1. åœ¨ç€è¦½å™¨æ§åˆ¶å°ä¸­å»ºç«‹æ¸¬è©¦è³‡æ–™ï¼š
   ```javascript
   // æ¨¡æ“¬ v1.2.X è³‡æ–™
   const v12Data = {
     stocks: [
       {
         stockCode: '2330',
         stockName: 'å°ç©é›»',
         quantity: 1000,
         buyPrice: 500,
         currentPrice: 550,
         buyDate: '2024-01-15',
         account: 'æ¸¬è©¦å¸³æˆ¶'
       }
     ],
     accounts: ['æ¸¬è©¦å¸³æˆ¶']
   };
   
   localStorage.setItem('stockPortfolio_v1.2', JSON.stringify(v12Data));
   ```

2. é‡æ–°æ•´ç†é é¢

3. æ‡‰è©²æœƒçœ‹åˆ°é·ç§»æç¤ºå°è©±æ¡†

4. é¸æ“‡ã€Œç¢ºå®šã€åŸ·è¡Œé·ç§»

5. æª¢æŸ¥é·ç§»çµæœï¼š
   ```javascript
   // æª¢æŸ¥æ–°ç‰ˆè³‡æ–™
   const newData = window.app.storageService.load();
   console.log('é·ç§»å¾Œçš„è³‡æ–™:', newData);
   
   // æª¢æŸ¥èˆŠç‰ˆè³‡æ–™æ˜¯å¦ä¿ç•™
   const oldData = localStorage.getItem('stockPortfolio_v1.2');
   console.log('èˆŠç‰ˆè³‡æ–™æ˜¯å¦ä¿ç•™:', oldData !== null);
   ```

## å¸¸è¦‹å•é¡Œ

### Q1: çœ‹åˆ° "Cannot use import statement outside a module" éŒ¯èª¤

**åŸå› **ï¼šç€è¦½å™¨ç„¡æ³•ç›´æ¥åŸ·è¡Œ TypeScript æˆ– ES6 æ¨¡çµ„ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šä½¿ç”¨ Vite é–‹ç™¼ä¼ºæœå™¨ï¼ˆ`npm run dev`ï¼‰ã€‚

### Q2: æ§åˆ¶å°é¡¯ç¤º "app is not defined"

**åŸå› **ï¼šæ‡‰ç”¨ç¨‹å¼å°šæœªåˆå§‹åŒ–å®Œæˆã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ç­‰å¾… `appReady` äº‹ä»¶
2. æˆ–åœ¨æ§åˆ¶å°ä¸­æª¢æŸ¥ `window.app` æ˜¯å¦å­˜åœ¨

### Q3: è‚¡åƒ¹æ›´æ–°å¤±æ•—

**åŸå› **ï¼šAPI å¯èƒ½æœ‰ CORS é™åˆ¶æˆ–ç¶²è·¯å•é¡Œã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æª¢æŸ¥ç¶²è·¯é€£ç·š
2. æŸ¥çœ‹æ§åˆ¶å°çš„éŒ¯èª¤è¨Šæ¯
3. è‚¡åƒ¹ API æœƒä¾åºå˜—è©¦ï¼šè­‰äº¤æ‰€ â†’ Yahoo â†’ æœ¬åœ°è³‡æ–™åº«

### Q4: è³‡æ–™æ²’æœ‰å„²å­˜

**åŸå› **ï¼šç€è¦½å™¨çš„ LocalStorage å¯èƒ½è¢«ç¦ç”¨æˆ–å·²æ»¿ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æª¢æŸ¥ç€è¦½å™¨è¨­å®šæ˜¯å¦å…è¨± LocalStorage
2. æ¸…ç†ç€è¦½å™¨è³‡æ–™é‡‹æ”¾ç©ºé–“
3. æª¢æŸ¥æ§åˆ¶å°çš„éŒ¯èª¤è¨Šæ¯

## ä¸‹ä¸€æ­¥

æ¸¬è©¦å®Œæˆå¾Œï¼Œæ‚¨å¯ä»¥ï¼š

1. **ç¹¼çºŒé–‹ç™¼**ï¼š
   - å¯¦ä½œä»»å‹™ 14ï¼šé›²ç«¯åŒæ­¥æœå‹™
   - å¯¦ä½œä»»å‹™ 15ï¼šå»ºç½®é…ç½®èˆ‡éƒ¨ç½²æº–å‚™
   - å¯¦ä½œä»»å‹™ 16ï¼šæ–‡æª”æ’°å¯«

2. **æ•´åˆ UI**ï¼š
   - å°‡ç¾æœ‰çš„ UI ä»£ç¢¼é·ç§»åˆ° TypeScript
   - å¯¦ä½œäº‹ä»¶ç›£è½å™¨
   - å„ªåŒ–ä½¿ç”¨è€…é«”é©—

3. **éƒ¨ç½²**ï¼š
   - å»ºç½®ç”Ÿç”¢ç‰ˆæœ¬
   - éƒ¨ç½²åˆ° Netlify æˆ–å…¶ä»–å¹³å°
   - è¨­å®š CI/CD æµç¨‹

## éœ€è¦å”åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°ä»»ä½•å•é¡Œï¼Œè«‹ï¼š
1. æª¢æŸ¥æ§åˆ¶å°çš„éŒ¯èª¤è¨Šæ¯
2. æŸ¥çœ‹ `.kiro/specs/v1.3-architecture-upgrade/` ç›®éŒ„ä¸­çš„æ–‡æª”
3. åŸ·è¡Œ `npm run type-check` æª¢æŸ¥ TypeScript éŒ¯èª¤
4. åŸ·è¡Œ `npm test` æª¢æŸ¥æ¸¬è©¦æ˜¯å¦é€šé
